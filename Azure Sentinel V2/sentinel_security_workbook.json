{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Log Analytics workspace"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources"
      }
    },
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Secon Cyber - Security Operations Dashboard",
      "metadata": {
        "description": "Display name for the workbook"
      }
    }
  },
  "variables": {
    "workbookId": "[guid(resourceGroup().id, parameters('workbookDisplayName'))]",
    "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
  },
  "resources": [
    {
      "type": "Microsoft.Insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[variables('workbookId')]",
      "location": "[parameters('location')]",
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Secon Cyber - Security Operations Dashboard\\n\\n![Secon Logo](https://github.com/user-attachments/assets/a66347b8-c453-4cac-b7f3-fe71a9c5d839)\\n\\nComprehensive security monitoring and incident response dashboard for Microsoft Sentinel environments.\"},\"name\":\"title\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"overview-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Overview\",\"subTarget\":\"overview\",\"style\":\"link\"},{\"id\":\"incidents-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incidents\",\"subTarget\":\"incidents\",\"style\":\"link\"},{\"id\":\"threats-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Threat Intelligence\",\"subTarget\":\"threats\",\"style\":\"link\"},{\"id\":\"analytics-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Analytics\",\"subTarget\":\"analytics\",\"style\":\"link\"},{\"id\":\"connectors-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Data Connectors\",\"subTarget\":\"connectors\",\"style\":\"link\"}]},\"name\":\"tabs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(24h)\\n| summarize Count = count() by Severity\\n| order by Count desc\",\"size\":3,\"title\":\"Incidents by Severity (Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"incidents-severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(7d)\\n| summarize Count = count() by bin(TimeGenerated, 1d)\\n| render timechart\",\"size\":3,\"title\":\"Incident Trend (Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"67\",\"name\":\"incident-trend\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n| where TimeGenerated >= ago(24h)\\n| summarize Count = count() by ProductName\\n| top 10 by Count\\n| render barchart\",\"size\":3,\"title\":\"Top Alert Sources (Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"alert-sources\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(24h)\\n| summarize \\n    Total = count(),\\n    Open = countif(Status == \\\"New\\\" or Status == \\\"Active\\\"),\\n    Closed = countif(Status == \\\"Closed\\\"),\\n    High = countif(Severity == \\\"High\\\"),\\n    Medium = countif(Severity == \\\"Medium\\\"),\\n    Low = countif(Severity == \\\"Low\\\")\\n| project Metric = \\\"Incidents (24h)\\\", Total, Open, Closed, High, Medium, Low\",\"size\":3,\"title\":\"Incident Summary\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"incident-summary\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"overview-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(30d)\\n| where Status != \\\"Closed\\\"\\n| project TimeGenerated, Title, Severity, Status, Owner, Classification\\n| order by TimeGenerated desc\\n| take 50\",\"size\":0,\"title\":\"Active Incidents (Last 30 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"yellow\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\"}]}}]}},\"name\":\"active-incidents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(24h)\\n| where Status == \\\"Closed\\\"\\n| summarize Count = count() by Classification\\n| render piechart\",\"size\":3,\"title\":\"Incident Classifications (Closed - Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"incident-classifications\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated >= ago(7d)\\n| summarize AvgTimeToClose = avg(datetime_diff('minute', ClosedTime, CreatedTime)) by bin(TimeGenerated, 1d)\\n| where isnotnull(AvgTimeToClose)\\n| render timechart\",\"size\":3,\"title\":\"Average Time to Close (Minutes)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"time-to-close\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"incidents-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated >= ago(7d)\\n| summarize Count = count() by ThreatType\\n| render piechart\",\"size\":3,\"title\":\"Threat Intelligence by Type (Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"threat-types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated >= ago(30d)\\n| where isnotnull(NetworkIP) or isnotnull(NetworkDestinationIP)\\n| extend IP = coalesce(NetworkIP, NetworkDestinationIP)\\n| summarize Count = count() by IP\\n| top 10 by Count\\n| render barchart\",\"size\":3,\"title\":\"Top Malicious IPs (Last 30 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"malicious-ips\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\n| where TimeGenerated >= ago(24h)\\n| where DeviceVendor contains \\\"Microsoft\\\"\\n| summarize Count = count() by DeviceProduct, Activity\\n| top 20 by Count\\n| render table\",\"size\":0,\"title\":\"Microsoft Security Events (Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"security-events\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"threats\"},\"name\":\"threats-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n| where TimeGenerated >= ago(24h)\\n| summarize Count = count() by AlertRuleTemplateName\\n| top 10 by Count\\n| render barchart\",\"size\":3,\"title\":\"Top Triggered Analytics Rules (Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"top-rules\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n| where TimeGenerated >= ago(7d)\\n| summarize Count = count() by bin(TimeGenerated, 1h), Severity\\n| render timechart\",\"size\":3,\"title\":\"Alert Trend by Severity (Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"alert-trend\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n| where TimeGenerated >= ago(24h)\\n| extend Tactics = tostring(parse_json(ExtendedProperties).\\\"Alert Tactics\\\")\\n| where isnotnull(Tactics) and Tactics != \\\"\\\"\\n| summarize Count = count() by Tactics\\n| render piechart\",\"size\":3,\"title\":\"MITRE ATT&CK Tactics (Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"mitre-tactics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n| where TimeGenerated >= ago(24h)\\n| summarize \\n    TotalAlerts = count(),\\n    HighSeverity = countif(AlertSeverity == \\\"High\\\"),\\n    MediumSeverity = countif(AlertSeverity == \\\"Medium\\\"),\\n    LowSeverity = countif(AlertSeverity == \\\"Low\\\"),\\n    UniqueRules = dcount(AlertRuleTemplateName)\\n| project Metric = \\\"Analytics Summary (24h)\\\", TotalAlerts, HighSeverity, MediumSeverity, LowSeverity, UniqueRules\",\"size\":3,\"title\":\"Analytics Summary\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"analytics-summary\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"analytics\"},\"name\":\"analytics-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\n| where TimeGenerated >= ago(7d)\\n| where IsBillable == true\\n| summarize DataVolume = sum(Quantity) by bin(TimeGenerated, 1d), DataType\\n| render timechart\",\"size\":3,\"title\":\"Data Ingestion Volume (Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"data-volume\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\n| where TimeGenerated >= ago(24h)\\n| where IsBillable == true\\n| summarize TotalGB = sum(Quantity) / 1024 by DataType\\n| top 10 by TotalGB\\n| render barchart\",\"size\":3,\"title\":\"Top Data Sources by Volume (GB - Last 24h)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"data-sources\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Heartbeat\\n| where TimeGenerated >= ago(5m)\\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\\n| extend Status = iff(LastHeartbeat >= ago(5m), \\\"Online\\\", \\\"Offline\\\")\\n| summarize Count = count() by Status\\n| render piechart\",\"size\":3,\"title\":\"Agent Status\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"agent-status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\n| where TimeGenerated >= ago(30d)\\n| where IsBillable == true\\n| summarize \\n    TotalGB = sum(Quantity) / 1024,\\n    DailyAvgGB = (sum(Quantity) / 1024) / 30,\\n    EstimatedMonthlyCost = (sum(Quantity) / 1024) * 2.76 // Approximate cost per GB\\n| project Metric = \\\"Data Connector Health (30d)\\\", TotalGB = round(TotalGB, 2), DailyAvgGB = round(DailyAvgGB, 2), EstimatedMonthlyCost = round(EstimatedMonthlyCost, 2)\",\"size\":3,\"title\":\"Data Connector Health Summary\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"connector-health\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"connectors\"},\"name\":\"connectors-group\"}],\"parameters\":[{\"id\":\"selectedTab\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"selectedTab\",\"type\":1,\"value\":\"overview\",\"isHiddenWhenLocked\":true}],\"styleSettings\":{\"spacingStyle\":\"narrow\",\"showBorder\":true}}",
        "category": "sentinel",
        "tags": [
          "Secon Cyber",
          "Microsoft Sentinel",
          "Security Operations",
          "SOC Dashboard",
          "Incident Response"
        ],
        "sourceId": "[variables('workspaceResourceId')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[variables('workbookId')]"
    },
    "workbookResourceId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Insights/workbooks', variables('workbookId'))]"
    }
  }
}