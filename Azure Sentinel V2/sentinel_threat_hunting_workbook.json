{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Log Analytics workspace"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources"
      }
    },
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Secon Cyber - Threat Hunting Dashboard",
      "metadata": {
        "description": "Display name for the threat hunting workbook"
      }
    }
  },
  "variables": {
    "workbookId": "[guid(resourceGroup().id, parameters('workbookDisplayName'))]",
    "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
  },
  "resources": [
    {
      "type": "Microsoft.Insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[variables('workbookId')]",
      "location": "[parameters('location')]",
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Secon Cyber - Threat Hunting Dashboard\\n\\n![Secon Logo](https://github.com/user-attachments/assets/a66347b8-c453-4cac-b7f3-fe71a9c5d839)\\n\\nAdvanced threat hunting and investigation workbook for Microsoft Sentinel environments.\\n\\n## ðŸŽ¯ Hunting Focus Areas\\n- **User Behavior Analytics** - Detect anomalous user activities\\n- **Network Traffic Analysis** - Identify suspicious network patterns\\n- **Process Execution** - Hunt for malicious processes and commands\\n- **File & Registry Activities** - Monitor for persistence mechanisms\\n- **Privilege Escalation** - Detect elevation attempts\\n- **Lateral Movement** - Identify compromise spread\"},\"name\":\"title\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"timeRange\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000}],\"allowCustom\":true}},{\"id\":\"suspiciousUser\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SuspiciousUser\",\"label\":\"Suspicious User (Optional)\",\"type\":1,\"value\":\"\",\"typeSettings\":{\"placeholderText\":\"Enter username to investigate\"}},{\"id\":\"suspiciousIP\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SuspiciousIP\",\"label\":\"Suspicious IP (Optional)\",\"type\":1,\"value\":\"\",\"typeSettings\":{\"placeholderText\":\"Enter IP address to investigate\"}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"user-behavior-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"User Behavior\",\"subTarget\":\"user-behavior\",\"style\":\"link\"},{\"id\":\"network-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Network Analysis\",\"subTarget\":\"network\",\"style\":\"link\"},{\"id\":\"process-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Process Execution\",\"subTarget\":\"process\",\"style\":\"link\"},{\"id\":\"persistence-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Persistence\",\"subTarget\":\"persistence\",\"style\":\"link\"},{\"id\":\"privilege-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Privilege Escalation\",\"subTarget\":\"privilege\",\"style\":\"link\"},{\"id\":\"lateral-tab\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Lateral Movement\",\"subTarget\":\"lateral\",\"style\":\"link\"}]},\"name\":\"hunting-tabs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## ðŸ‘¤ User Behavior Analytics\\n\\nHunt for anomalous user activities that may indicate compromise or insider threats.\"},\"name\":\"user-behavior-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated {TimeRange}\\n| where UserPrincipalName contains \\\"{SuspiciousUser}\\\" or \\\"{SuspiciousUser}\\\" == \\\"\\\"\\n| extend Country = tostring(LocationDetails.countryOrRegion)\\n| summarize \\n    LoginCount = count(),\\n    UniqueCountries = dcount(Country),\\n    Countries = make_set(Country),\\n    FailedLogins = countif(ResultType != \\\"0\\\"),\\n    SuccessRate = round((todouble(countif(ResultType == \\\"0\\\")) / todouble(count())) * 100, 2)\\n    by UserPrincipalName\\n| where UniqueCountries > 1 or FailedLogins > 10\\n| order by UniqueCountries desc, FailedLogins desc\",\"size\":0,\"title\":\"ðŸŒ Users with Multi-Country Logins or High Failed Attempts\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"FailedLogins\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"20\",\"representation\":\"redBright\"},{\"operator\":\">=\",\"thresholdValue\":\"10\",\"representation\":\"yellow\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"green\"}]}},{\"columnMatch\":\"SuccessRate\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"<\",\"thresholdValue\":\"50\",\"representation\":\"redBright\"},{\"operator\":\"<\",\"thresholdValue\":\"80\",\"representation\":\"yellow\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"green\"}]}}]}},\"name\":\"multi-country-logins\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated {TimeRange}\\n| where UserPrincipalName contains \\\"{SuspiciousUser}\\\" or \\\"{SuspiciousUser}\\\" == \\\"\\\"\\n| where ResultType == \\\"0\\\"\\n| extend Hour = hourofday(TimeGenerated)\\n| summarize LoginCount = count() by Hour, UserPrincipalName\\n| where LoginCount > 5\\n| evaluate pivot(Hour, sum(LoginCount))\\n| order by UserPrincipalName\",\"size\":0,\"title\":\"â° Off-Hours Login Activity (Successful Logins by Hour)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"off-hours-activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\n| where TimeGenerated {TimeRange}\\n| where InitiatedBy.user.userPrincipalName contains \\\"{SuspiciousUser}\\\" or \\\"{SuspiciousUser}\\\" == \\\"\\\"\\n| where ActivityDisplayName in (\\\"Add member to role\\\", \\\"Remove member from role\\\", \\\"Add user\\\", \\\"Delete user\\\", \\\"Update user\\\", \\\"Reset user password\\\")\\n| extend Actor = tostring(InitiatedBy.user.userPrincipalName)\\n| extend Target = tostring(TargetResources[0].userPrincipalName)\\n| project TimeGenerated, Actor, ActivityDisplayName, Target, Result\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ” Privileged Operations (User Management Activities)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ActivityDisplayName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"contains\",\"thresholdValue\":\"Delete\",\"representation\":\"redBright\"},{\"operator\":\"contains\",\"thresholdValue\":\"Add member to role\",\"representation\":\"orange\"},{\"operator\":\"contains\",\"thresholdValue\":\"Reset\",\"representation\":\"yellow\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\"}]}}]}},\"name\":\"privileged-operations\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where Account contains \\\"{SuspiciousUser}\\\" or \\\"{SuspiciousUser}\\\" == \\\"\\\"\\n| where EventID in (4624, 4625, 4648, 4672)\\n| extend EventDescription = case(\\n    EventID == 4624, \\\"Successful Logon\\\",\\n    EventID == 4625, \\\"Failed Logon\\\",\\n    EventID == 4648, \\\"Logon with Explicit Credentials\\\",\\n    EventID == 4672, \\\"Special Privileges Assigned\\\",\\n    \\\"Unknown\\\")\\n| summarize Count = count() by Account, EventDescription, bin(TimeGenerated, 1h)\\n| render timechart\",\"size\":0,\"title\":\"ðŸ“Š Windows Authentication Events Timeline\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"windows-auth-timeline\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"user-behavior\"},\"name\":\"user-behavior-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## ðŸŒ Network Traffic Analysis\\n\\nAnalyze network patterns to identify suspicious connections, data exfiltration, and C2 communications.\"},\"name\":\"network-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\n| where TimeGenerated {TimeRange}\\n| where SourceIP contains \\\"{SuspiciousIP}\\\" or DestinationIP contains \\\"{SuspiciousIP}\\\" or \\\"{SuspiciousIP}\\\" == \\\"\\\"\\n| extend GeoInfo = geo_info_from_ip_address(SourceIP)\\n| extend Country = tostring(GeoInfo.country)\\n| summarize \\n    ConnectionCount = count(),\\n    UniqueDestinations = dcount(DestinationIP),\\n    Countries = make_set(Country),\\n    BytesSent = sum(SentBytes),\\n    BytesReceived = sum(ReceivedBytes)\\n    by SourceIP\\n| where ConnectionCount > 100 or UniqueDestinations > 50\\n| order by ConnectionCount desc\",\"size\":0,\"title\":\"ðŸš¨ High Volume Network Connections\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ConnectionCount\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1000\",\"representation\":\"redBright\"},{\"operator\":\">=\",\"thresholdValue\":\"500\",\"representation\":\"yellow\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"green\"}]}},{\"columnMatch\":\"BytesSent\",\"formatter\":1},{\"columnMatch\":\"BytesReceived\",\"formatter\":1}]}},\"name\":\"high-volume-connections\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DnsEvents\\n| where TimeGenerated {TimeRange}\\n| where ClientIP contains \\\"{SuspiciousIP}\\\" or \\\"{SuspiciousIP}\\\" == \\\"\\\"\\n| where Name contains \\\"bit.ly\\\" or Name contains \\\"tinyurl\\\" or Name contains \\\"pastebin\\\" or Name endswith \\\".tk\\\" or Name endswith \\\".ml\\\" or Name endswith \\\".ga\\\"\\n| summarize QueryCount = count() by ClientIP, Name\\n| order by QueryCount desc\\n| take 50\",\"size\":0,\"title\":\"ðŸ”— Suspicious Domain Queries (URL Shorteners & Free Domains)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"suspicious-domains\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"NetworkCommunicationEvents\\n| where TimeGenerated {TimeRange}\\n| where RemoteIP contains \\\"{SuspiciousIP}\\\" or \\\"{SuspiciousIP}\\\" == \\\"\\\"\\n| extend GeoInfo = geo_info_from_ip_address(RemoteIP)\\n| extend Country = tostring(GeoInfo.country)\\n| where Country in (\\\"Russia\\\", \\\"China\\\", \\\"North Korea\\\", \\\"Iran\\\")\\n| summarize ConnectionCount = count() by RemoteIP, Country, RemotePort\\n| order by ConnectionCount desc\",\"size\":0,\"title\":\"ðŸŒ Connections to High-Risk Countries\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"high-risk-countries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\n| where TimeGenerated {TimeRange}\\n| where DestinationPort in (4444, 4445, 8080, 8888, 9999) or SourcePort in (4444, 4445, 8080, 8888, 9999)\\n| summarize Count = count() by SourceIP, DestinationIP, DestinationPort\\n| order by Count desc\\n| take 25\",\"size\":0,\"title\":\"âš ï¸ Suspicious Port Activity (Common C2 Ports)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"suspicious-ports\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},\"name\":\"network-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## ðŸ”§ Process Execution Analysis\\n\\nDetect malicious processes, command line activities, and execution patterns.\"},\"name\":\"process-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4688\\n| where Process contains \\\"powershell\\\" or Process contains \\\"cmd\\\" or Process contains \\\"wscript\\\" or Process contains \\\"cscript\\\"|where CommandLine contains \\\"downloadstring\\\" or CommandLine contains \\\"invoke-expression\\\" or CommandLine contains \\\"bypass\\\" or CommandLine contains \\\"hidden\\\" or CommandLine contains \\\"encoded\\\"\\n| project TimeGenerated, Computer, Account, Process, CommandLine\\n| order by TimeGenerated desc\\n| take 100\",\"size\":0,\"title\":\"ðŸ’€ Suspicious PowerShell & Script Execution\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CommandLine\",\"formatter\":1,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}]}},\"name\":\"suspicious-scripts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\n| where TimeGenerated {TimeRange}\\n| where ProcessCommandLine contains \\\"mshta\\\" or ProcessCommandLine contains \\\"regsvr32\\\" or ProcessCommandLine contains \\\"rundll32\\\" or ProcessCommandLine contains \\\"bitsadmin\\\"\\n| where ProcessCommandLine contains \\\"http\\\" or ProcessCommandLine contains \\\"ftp\\\"\\n| project TimeGenerated, DeviceName, AccountName, FileName, ProcessCommandLine\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸŒ Living-off-the-Land Binary (LOLBin) Network Activity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"lolbin-network\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4688\\n| where Process endswith \\\"svchost.exe\\\" or Process endswith \\\"lsass.exe\\\" or Process endswith \\\"winlogon.exe\\\"\\n| where ParentProcessName !endswith \\\"services.exe\\\" and ParentProcessName !endswith \\\"wininit.exe\\\"\\n| project TimeGenerated, Computer, Account, Process, ParentProcessName, CommandLine\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ‘¹ Suspicious System Process Parents\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"suspicious-parents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\n| where TimeGenerated {TimeRange}\\n| where ProcessCommandLine contains \\\"whoami\\\" or ProcessCommandLine contains \\\"net user\\\" or ProcessCommandLine contains \\\"net group\\\" or ProcessCommandLine contains \\\"net localgroup\\\" or ProcessCommandLine contains \\\"tasklist\\\" or ProcessCommandLine contains \\\"systeminfo\\\"\\n| summarize Count = count() by DeviceName, AccountName, bin(TimeGenerated, 10m)\\n| where Count >= 3\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ” Reconnaissance Command Clusters\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"recon-commands\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"process\"},\"name\":\"process-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## ðŸ  Persistence Mechanisms\\n\\nDetect various persistence techniques used by attackers to maintain access.\"},\"name\":\"persistence-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID in (4656, 4658, 4663)\\n| where ObjectName contains \\\"CurrentVersion\\\\\\\\Run\\\" or ObjectName contains \\\"CurrentVersion\\\\\\\\RunOnce\\\" or ObjectName contains \\\"CurrentVersion\\\\\\\\RunServices\\\"\\n| where AccessMask contains \\\"WriteData\\\" or AccessMask contains \\\"SetValue\\\"\\n| project TimeGenerated, Computer, SubjectUserName, ObjectName, ProcessName\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ“ Registry Run Key Modifications\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"registry-run-keys\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4698\\n| where TaskName !startswith \\\"Microsoft\\\\\\\\\\\" and TaskName !startswith \\\"\\\\\\\\Microsoft\\\\\\\\\\\"\\n| project TimeGenerated, Computer, SubjectUserName, TaskName, TaskContent\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"â° Scheduled Task Creation (Non-Microsoft)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"scheduled-tasks\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4697\\n| where ServiceName !in (\\\"BITS\\\", \\\"Themes\\\", \\\"AudioSrv\\\", \\\"Dhcp\\\", \\\"eventlog\\\", \\\"lmhosts\\\", \\\"wscsvc\\\")\\n| project TimeGenerated, Computer, SubjectUserName, ServiceName, ServiceFileName\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ”§ Service Installation Events\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"service-installation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\n| where TimeGenerated {TimeRange}\\n| where FolderPath startswith \\\"C:\\\\\\\\Users\\\\\\\\\\\" and FolderPath endswith \\\"\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\Start Menu\\\\\\\\Programs\\\\\\\\Startup\\\\\\\\\\\"\\n| where ActionType == \\\"FileCreated\\\"\\n| project TimeGenerated, DeviceName, InitiatingProcessAccountName, FileName, FolderPath\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸš€ Startup Folder File Creation\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"startup-folder\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"persistence\"},\"name\":\"persistence-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## â¬†ï¸ Privilege Escalation\\n\\nDetect attempts to elevate privileges and gain administrative access.\"},\"name\":\"privilege-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4672\\n| where SubjectUserName !in (\\\"SYSTEM\\\", \\\"LOCAL SERVICE\\\", \\\"NETWORK SERVICE\\\")\\n| where PrivilegeList contains \\\"SeDebugPrivilege\\\" or PrivilegeList contains \\\"SeTakeOwnershipPrivilege\\\" or PrivilegeList contains \\\"SeLoadDriverPrivilege\\\"\\n| summarize Count = count() by SubjectUserName, Computer, PrivilegeList\\n| order by Count desc\",\"size\":0,\"title\":\"ðŸ” Dangerous Privileges Assigned\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"dangerous-privileges\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID in (4728, 4732, 4756)\\n| where TargetUserName in (\\\"Administrators\\\", \\\"Domain Admins\\\", \\\"Enterprise Admins\\\", \\\"Schema Admins\\\")\\n| project TimeGenerated, Computer, SubjectUserName, TargetUserName, MemberName\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸ‘‘ Administrative Group Membership Changes\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"admin-group-changes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\n| where TimeGenerated {TimeRange}\\n| where ProcessCommandLine contains \\\"runas\\\" or ProcessCommandLine contains \\\"sudo\\\" or FileName in (\\\"psexec.exe\\\", \\\"psexec64.exe\\\")\\n| project TimeGenerated, DeviceName, AccountName, FileName, ProcessCommandLine\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸŽ­ Process Elevation Attempts\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"process-elevation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4648\\n| where SubjectUserName != TargetUserName\\n| where TargetUserName in (\\\"Administrator\\\", \\\"admin\\\") or TargetUserName contains \\\"admin\\\"\\n| project TimeGenerated, Computer, SubjectUserName, TargetUserName, ProcessName, IpAddress\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"ðŸŽ¯ Explicit Credential Usage (RunAs)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"explicit-creds\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"privilege\"},\"name\":\"privilege-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## â†”ï¸ Lateral Movement\\n\\nDetect attempts to move laterally through the network and compromise additional systems.\"},\"name\":\"lateral-title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4624\\n| where LogonType in (3, 10)\\n| where IpAddress != \\\"-\\\" and IpAddress != \\\"127.0.0.1\\\"\\n| summarize UniqueTargets = dcount(Computer), Computers = make_set(Computer) by Account, IpAddress\\n| where UniqueTargets >= 3\\n| order by UniqueTargets desc\",\"size\":0,\"title\":\"ðŸŒ Network Logons to Multiple Systems\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"network-logons\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 5140\\n| where ShareName !in (\\\"ADMIN$\\\", \\\"C$\\\", \\\"IPC$\\\", \\\"PRINT$\\\")\\n| summarize Count = count() by SubjectUserName, IpAddress, ShareName\\n| where Count > 10\\n| order by Count desc\",\"size\":0,\"title\":\"ðŸ“ Suspicious SMB Share Access\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"smb-access\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkEvents\\n| where TimeGenerated {TimeRange}\\n| where RemotePort in (135, 445, 3389, 5985, 5986)\\n| summarize UniqueRemoteIPs = dcount(RemoteIP), RemoteIPs = make_set(RemoteIP) by DeviceName, InitiatingProcessAccountName\\n| where UniqueRemoteIPs >= 5\\n| order by UniqueRemoteIPs desc\",\"size\":0,\"title\":\"ðŸ”Œ Remote Administration Tool Usage\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"remote-admin\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n| where TimeGenerated {TimeRange}\\n| where EventID == 4688\\n| where Process endswith \\\"wmic.exe\\\" and CommandLine contains \\\"process call create\\\"\\n| project TimeGenerated, Computer, SubjectUserName, CommandLine\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"âš¡ WMI Remote Process Execution\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"wmi-execution\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"lateral\"},\"name\":\"lateral-group\"}],\"parameters\":[{\"id\":\"selectedTab\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"selectedTab\",\"type\":1,\"value\":\"user-behavior\",\"isHiddenWhenLocked\":true}],\"styleSettings\":{\"spacingStyle\":\"narrow\",\"showBorder\":true}}"